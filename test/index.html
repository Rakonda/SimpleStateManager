<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>QUnit - SimpleStateManager</title>
        <link rel="stylesheet" href="resources/qunit.css">
        <script src="resources/bind.poly.js"></script>
        <script src="resources/matchmedia.mock.js"></script>
        <script src="../src/ssm.js" data-cover></script>
    </head>
    <body>
        <div id="qunit"></div>
        <div id="qunit-fixture"></div>

        <script src="resources/qunit.js"></script>
        <script src="resources/blanket.min.js"></script>
        <script>

            test("Check enter event fires", function() {
                var fired = true;

                ssm.addState(
                    {
                        id: 'desktop',
                        onEnter: function(){
                            fired = true;
                        }
                    }
                );

                ssm.removeAllStates();

                ok(fired === true, "Passed");
            });

            test("add config option", function() {
                ssm.addConfigOption({name:'minHeight', test: function(){}});

                ok(ssm.getConfigOption().length === 1, "Passed");

                ssm.removeConfigOption('minHeight');

                ok(ssm.getConfigOption().length === 0, "Passed");
            });


            test("add active state", function() {
                var id = 'test',
                    query = '(min-width: 100px)',
                    onEnter = function() {},
                    onLeave = function() {},
                    onResize = function() {};

                var state = ssm.addState({
                    id: id,
                    query: query,
                    onEnter: onEnter,
                    onLeave: onLeave,
                    onResize: onResize
                });

                ssm.removeAllStates();

                ok(state.id === id, "Passed");
                ok(state.query === query, "Passed");
                ok(state.options.onEnter[0] === onEnter, "Passed");
                ok(state.options.onResize[0] === onResize, "Passed");
                ok(state.active === true, "Passed");
            });

            test("add inactive state", function() {
                var id = 'test',
                    query = '(max-width: 1000px)',
                    onEnter = function() {},
                    onLeave = function() {},
                    onResize = function() {};

                var state = ssm.addState({
                    id: id,
                    query: query,
                    onEnter: onEnter,
                    onLeave: onLeave,
                    onResize: onResize
                });

                ok(state.id === id, "Passed");
                ok(state.query === query, "Passed");
                ok(state.options.onEnter[0] === onEnter, "Passed");
                ok(state.options.onResize[0] === onResize, "Passed");
                ok(state.active === false, "Passed");

                ssm.removeAllStates();
            });

            test("test browser resize matchmedia matching", function() {
                var id = 'browserMatchMediaTest',
                    query = '(max-width: 320px)',
                    onEnter = function() {
                        browserEnter = true;
                    },
                    onLeave = function() {
                        browserLeave = true;
                    },
                    browserEnter = false;
                    browserLeave = false;

                var state = ssm.addState({
                    id: id,
                    query: query,
                    onEnter: onEnter,
                    onLeave: onLeave
                });

                window.matchMedia.set({
                    width: 300
                });

                window.matchMedia.set({
                    width: 1024
                });

                ok(browserEnter === true, "Passed");
                ok(browserLeave === true, "Passed");

                
                ssm.removeAllStates();
            });

            test("remove state", function() {
                ssm.addState({
                    id: 'desktop'
                });

                ssm.removeState('desktop');

                ok(ssm.getStates().length === 0, "Passed");

                ssm.removeAllStates();
            });

            test("get states", function() {
                ssm.addStates([
                    {
                        id: 'desktop'
                    }, 
                    {
                        id: 'tablet'
                    },
                    {
                        id: 'mobile'
                    }
                ]);

                ok(ssm.getStates().length === 3, "Passed");

                ssm.removeAllStates();
            });

            test("remove multiple states", function() {
                ssm.addStates([
                    {
                        id: 'desktop'
                    }, {
                        id: 'tablet'
                    }
                ]);

                ok(ssm.getStates().length === 2, "Passed");

                ssm.removeAllStates();

                ok(ssm.getStates().length === 0, "Passed");
            });

            test("add and remove config option's", function() {
                var configOptions = ssm.getConfigOption().length;

                ssm.addConfigOption({
                    name: 'test',
                    test: function(){}
                });

                ok(ssm.getConfigOption().length === (configOptions + 1), "Passed Adding Config Option");

                ssm.removeConfigOption('test');

                ok(ssm.getConfigOption().length === configOptions, "Passed Removing Config Option");
            });

            test("config option once", function() {
                var stateMatch = false;

                ssm.addConfigOption({
                    name: 'once',
                    test: function(){
                        return false;
                    },
                    when: 'once'
                });


                ok(ssm.getConfigOptions().length === 1, "Passed always false config option added");

                ssm.addState({
                    id: 'onceState',
                    once: 'value',
                    onEnter: function() {
                        stateMatch = true;
                    }
                });

                ok(stateMatch === false, "Passed state not matched");

                ok(ssm.getStates().length === 0, "Passed state not added as not matched");

                ssm.removeConfigOption('once');

                ok(ssm.getConfigOptions().length === 0, "Passed always false config option removed");

                stateMatch = false;

                ssm.addConfigOption({
                    name: 'once',
                    test: function(){
                        return true;
                    },
                    when: 'once'
                });

                ok(ssm.getConfigOptions().length === 1, "Passed always true config option added");

                ssm.addState({
                    id: 'onceState',
                    once: 'value',
                    onEnter: function() {
                        stateMatch = true;
                    }
                });

                ok(stateMatch === true, "Passed state matched");
                ok(ssm.getStates().length === 1, "Passed state not added as matched");

                ssm.removeState('onceState');

                ok(ssm.getStates().length === 0, "Passed remove state");


                ssm.removeConfigOption('once');

                ok(ssm.getConfigOptions().length === 0, "Passed always true config option removed");

            });
        </script>
    </body>
</html>